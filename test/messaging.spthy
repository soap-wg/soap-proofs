theory MessagingTest
begin

#include "../src/header.spthy"
#include "../src/tls.spthy"
#include "../src/messaging.spthy"

lemma OTPChallenge[sources]:
  "All challenge #t.
        MustBeOTP(challenge) @ #t
    ==>   (Ex #x. KU(challenge) @ #x & #x < #t)
        | (Ex #x. IsOTP(challenge) @ #x)"

lemma MessagingExecutability:
  exists-trace
  "Ex senderPhone myPhone m #t.
      ReceiveMessaging(senderPhone, myPhone, m) @ #t
    & (not Ex #x. SomeCompromise() @ #x)"

lemma MessagingSenderInvariance:
  "All senderKey myKey m #t.
        ( ReceiveMessaging(senderKey, myKey, m) @ #t)
    ==> ( (Ex #x. SendMessaging(senderKey, myKey, m) @ #x)
        | KeyServerCompromise()
        | (Ex #x. SMSLeak() @ #x)
        | (Ex s #x. CompromisedMessaging(s, senderKey) @ #x))"

end
